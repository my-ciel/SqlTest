##############################################################
# TEST 1 : 인덱스를 사용한 쿼리 성능의 향상
##############################################################
1. BIGEMP 테이블의 EMPLOYEE_ID 열에 인덱스가 없음을 확인합니다.
SELECT table_name, index_name
FROM user_indexes
WHERE table_name = 'BIGEMP'

2. 하나의 행을 검색하는 명령문을 실행하고 실행계획을 확인합니다.
EXPLAIN PLAN FOR
SELECT * FROM bigemp
WHERE employee_id = 1100;
SELECT * FROM table(dbms_xplan.display);

3. EMPLOYEE_ID 열에 인덱스를 추가합니다.
CREATE INDEX bigemp_id_ix ON bigemp(employee_id);

4. 다시 쿼리 실행 및 실행계획을 확인해 봅니다.
EXPLAIN PLAN FOR
SELECT * FROM bigemp
WHERE employee_id = 1100;
SELECT * FROM table(dbms_xplan.display);

##############################################################
# TEST 2 : 제약조건과 인덱스 
##############################################################
SELECT table_name, constraint_name, constraint_type
FROM user_constraints
WHERE table_name='EMPLOYEES';

SELECT table_name, index_name, uniqueness
FROM user_indexes
WHERE table_name='EMPLOYEES';

DROP INDEX SYS_C007334; 

ALTER TABLE employees
DROP PRIMARY KEY CASCADE;

SELECT table_name, constraint_name, constraint_type
FROM user_constraints
WHERE table_name='EMPLOYEES';

SELECT table_name, index_name, uniqueness
FROM user_indexes
WHERE table_name='EMPLOYEES';

ALTER TABLE EMPLOYEES
ADD CONSTRAINT emp_empid_pk PRIMARY KEY (employee_id);

SELECT table_name, constraint_name, constraint_type
FROM user_constraints
WHERE table_name='EMPLOYEES';

SELECT table_name, index_name, uniqueness
FROM user_indexes
WHERE table_name='EMPLOYEES';


##############################################################
# TEST 3 : 여러유형의 인덱스 실습
##############################################################
1. B-Tree 인덱스
EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE last_name = 'Rogers';
SELECT * FROM table(dbms_xplan.display);

CREATE INDEX emp_lname_ix ON employees(last_name);

EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE last_name = 'Rogers';
SELECT * FROM table(dbms_xplan.display);

DROP INDEX emp_lname_ix;

2. 조합 인덱스 예제 
CREATE INDEX emp_name_ix ON employees(first_name, last_name);

EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE first_name='David' AND last_name = 'Williams';
SELECT * FROM table(dbms_xplan.display);

	

EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE first_name='Luis';
SELECT * FROM table(dbms_xplan.display);

--Index Skip Scan 확인 
EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE last_name = 'Chen';
SELECT * FROM table(dbms_xplan.display);

DROP INDEX  emp_name_ix;

3. 함수기반 인덱스
CREATE INDEX emp_sal_ix ON employees(salary);
EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE salary*0.9 > 12000;
SELECT * FROM table(dbms_xplan.display);
DROP INDEX emp_sal_ix;

CREATE INDEX emp_sal_ix ON employees(salary*0.9);
EXPLAIN PLAN FOR
SELECT * FROM employees
WHERE salary*0.9 > 12000;
SELECT * FROM table(dbms_xplan.display);

DROP INDEX emp_sal_ix;

4. 비트맵 인덱스
ALTER TABLE customers ADD (cust_gender CHAR(1));

UPDATE customers
SET cust_gender = CASE
               WHEN DBMS_RANDOM.VALUE(0, 1) < 0.75 THEN 'F'  
               ELSE 'M'                                      
             END;

COMMIT;

SELECT DISTINCT cust_gender from customers;
CREATE INDEX cust_gender_ix ON customers(cust_gender);

EXPLAIN PLAN FOR
SELECT * FROM customers
WHERE cust_gender = 'F';
SELECT * FROM table(dbms_xplan.display);

EXPLAIN PLAN FOR
SELECT cust_gender, count(*) FROM customers
GROUP BY cust_gender;
SELECT * FROM table(dbms_xplan.display);

ANALYZE INDEX cust_gender_ix COMPUTE STATISTICS;
desc user_indexes
SELECT blevel, leaf_blocks, distinct_keys, clustering_factor
FROM user_indexes
WHERE index_name = 'CUST_GENDER_IX';

DROP INDEX cust_gender_ix;

CREATE BITMAP INDEX cust_gender_ix ON customers(cust_gender);

EXPLAIN PLAN FOR
SELECT * FROM customers
WHERE cust_gender = 'F';
SELECT * FROM table(dbms_xplan.display);

EXPLAIN PLAN FOR
SELECT cust_gender, count(*) FROM customers
GROUP BY cust_gender;
SELECT * FROM table(dbms_xplan.display);

ANALYZE INDEX cust_gender_ix COMPUTE STATISTICS;
SELECT blevel, leaf_blocks, distinct_keys, clustering_factor
FROM user_indexes
WHERE index_name = 'CUST_GENDER_IX';

DROP INDEX cust_gender_ix;